package examples

import (
	"fmt"

	"github.com/engelsjk/planeta/geo"
	"github.com/engelsjk/planeta/geo/geogfn"
	"github.com/engelsjk/planeta/geo/geomfn"
	"github.com/engelsjk/planeta/geo/geoprojbase"
	"github.com/engelsjk/planeta/geo/geotransform"
	"github.com/twpayne/go-geom/encoding/geojson"
)

func ExampleBasic() {

	geomPolygon, _ := geo.ParseGeometry("POLYGON((-2.0 0.0, 0.0 0.0, 0.0 1.0, -2.0 1.0, -2.0 0.0))")
	geomLineString, _ := geo.ParseGeometry("LINESTRING(-0.5 0.5, 0.5 0.5)")

	fmt.Println(geomfn.Length(geomLineString))
	// 1

	fmt.Println(geomfn.Area(geomPolygon))
	// 2

	fmt.Println(geomfn.Intersects(geomPolygon, geomLineString))
	// true
}

func ExampleGeoJSON() {

	b1 := []byte(`{"type": "Feature","properties": {},"geometry": {"type": "Polygon", "coordinates": [[[-83.5345458984375,39.5633531658293], [-82.4139404296875,39.5633531658293], [-82.4139404296875,40.39258071969131], [-83.5345458984375,40.39258071969131], [-83.5345458984375,39.5633531658293]]]}}`)
	b2 := []byte(`{"type": "Feature","properties": {"name": "example"},"geometry": {"type": "Polygon","coordinates": [[[-83.023681640625,39.104488809440475],[-81.968994140625,39.104488809440475],[-81.968994140625,39.85072092501597],[-83.023681640625,39.85072092501597],[-83.023681640625,39.104488809440475]]]}}`)

	var feature1, feature2 geojson.Feature

	_ = feature1.UnmarshalJSON(b1)
	_ = feature2.UnmarshalJSON(b2)

	geometry1, _ := geo.MakeGeometryFromGeomT(feature1.Geometry)
	geometry2, _ := geo.MakeGeometryFromGeomT(feature2.Geometry)

	intersects, _ := geomfn.Intersects(geometry1, geometry2)

	fmt.Println(intersects)
	// true

	intersection, _ := geomfn.Intersection(geometry1, geometry2)

	g, _ := intersection.AsGeomT()
	b, _ := geojson.Marshal(g)

	fmt.Println(string(b))
	// {"type":"Polygon","coordinates":[[[-82.4139404296875,39.85072092501597],[-82.4139404296875,39.5633531658293],[-83.023681640625,39.5633531658293],[-83.023681640625,39.85072092501597],[-82.4139404296875,39.85072092501597]]]}
}

func ExampleGeography() {

	geogLineString, _ := geo.ParseGeography("LINESTRING(-109.00463303324997 37.08890778791475,-109.09252365824997 36.90629181998808)")
	geogPolygon, _ := geo.ParseGeography("POLYGON((-109.1268559336406 37.04617221507986,-108.9620610117656 37.04617221507986,-108.9620610117656 36.9595315239561,-109.1268559336406 36.9595315239561,-109.1268559336406 37.04617221507986))")

	fmt.Println(geogfn.Length(geogLineString, geogfn.UseSphere))
	// 21754.45520583837

	fmt.Println(geogfn.Area(geogPolygon, geogfn.UseSphere))
	// 1.4098377428322914e+08

	fmt.Println(geogfn.Intersects(geogLineString, geogPolygon))
	// true
}

func ExampleBuffer() {

	b := []byte(`{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[-82.863342,41.693693],[-82.842099,41.628323],[-82.788876,41.643047],[-82.782719,41.694003],[-82.82572,41.72281],[-82.863342,41.693693]]],[[[-84.820159,39.227225],[-84.820157,39.10548],[-84.750749,39.147358],[-84.714048,39.132659],[-84.677247,39.09826],[-84.6220277,39.0783275],[-84.607928,39.073238],[-84.550844,39.09936],[-84.5065187,39.1017664],[-84.4991878,39.1021644],[-84.493743,39.10246],[-84.480943,39.11676],[-84.462042,39.12176],[-84.445242,39.114461],[-84.432941,39.083961],[-84.40094,39.046362],[-84.326539,39.027463],[-84.3212072,39.0205864],[-84.297255,38.989694],[-84.288164,38.955789],[-84.232132,38.880483],[-84.232305,38.8747079],[-84.233265,38.842671],[-84.2261626,38.8297771],[-84.212904,38.805707],[-84.135088,38.789485],[-84.0526462,38.7716147],[-84.051642,38.771397],[-83.978814,38.787104],[-83.928454,38.774583],[-83.9043751,38.7672839],[-83.852085,38.751433],[-83.834015,38.716008],[-83.78362,38.695641],[-83.77216,38.65815],[-83.7058616,38.6380379],[-83.679484,38.630036],[-83.6469114,38.6418519],[-83.642994,38.643273],[-83.626922,38.679387],[-83.533339,38.702105],[-83.440404,38.669361],[-83.376302,38.661473],[-83.320531,38.622713],[-83.286514,38.599241],[-83.2642989,38.6131125],[-83.239515,38.628588],[-83.172647,38.620252],[-83.128973,38.640231],[-83.112372,38.671685],[-83.042338,38.708319],[-83.0303349,38.7168677],[-83.011816,38.730057],[-82.943147,38.74328],[-82.889193,38.756076],[-82.88229,38.7416192],[-82.871192,38.718377],[-82.869592,38.678177],[-82.851314,38.604334],[-82.8115424,38.5723696],[-82.800112,38.563183],[-82.724846,38.5576],[-82.675724,38.515504],[-82.6641169,38.5077156],[-82.618474,38.477089],[-82.593673,38.421809],[-82.560664,38.404338],[-82.5089669,38.4146439],[-82.447076,38.426982],[-82.381773,38.434783],[-82.323999,38.449268],[-82.304223,38.496308],[-82.293271,38.560283],[-82.2821333,38.5798608],[-82.27427,38.593683],[-82.218967,38.591683],[-82.175167,38.608484],[-82.185567,38.659583],[-82.201537,38.760372],[-82.20929,38.802672],[-82.16157,38.824632],[-82.134766,38.905579],[-82.0988667,38.9608793],[-82.089065,38.975978],[-82.041563,39.017878],[-82.007062,39.029578],[-81.941829,38.993295],[-81.89847,38.929603],[-81.827354,38.945898],[-81.775734,38.980737],[-81.793304,39.040353],[-81.807855,39.083978],[-81.7502668,39.1040312],[-81.742953,39.106578],[-81.752297,39.1810347],[-81.752754,39.184676],[-81.7214681,39.2109608],[-81.711628,39.219228],[-81.678331,39.273755],[-81.613896,39.275339],[-81.565247,39.276175],[-81.559647,39.330774],[-81.503189,39.373242],[-81.456143,39.409274],[-81.412706,39.394618],[-81.393794,39.351706],[-81.3703898,39.3487007],[-81.347567,39.34577],[-81.249088,39.389992],[-81.185946,39.430731],[-81.128533,39.449375],[-81.1212739,39.4576974],[-81.07595,39.50966],[-81.037365,39.5380557],[-80.943782,39.606926],[-80.865575,39.662751],[-80.829764,39.711839],[-80.8355217,39.7192518],[-80.869933,39.763555],[-80.824969,39.801092],[-80.824276,39.847159],[-80.8234381,39.8500321],[-80.803394,39.918762],[-80.764479,39.95025],[-80.740126,39.970793],[-80.7382184,40.0335432],[-80.736804,40.080072],[-80.705994,40.151591],[-80.7025753,40.1571414],[-80.6841732,40.187018],[-80.644598,40.25127],[-80.606596,40.303869],[-80.631596,40.385468],[-80.6273626,40.3951709],[-80.604895,40.446667],[-80.622195,40.520497],[-80.667957,40.582496],[-80.627171,40.619936],[-80.583633,40.61552],[-80.518991,40.638801],[-80.5197051,40.8513368],[-80.5198697,40.9003239],[-80.519891,40.906661],[-80.5196438,40.9873927],[-80.5192221,41.1250936],[-80.5191967,41.1333865],[-80.518893,41.232556],[-80.5190001,41.3335021],[-80.5191652,41.4890122],[-80.5191768,41.4999241],[-80.519357,41.669767],[-80.5193967,41.849563],[-80.519425,41.977523],[-80.581882,41.95761],[-80.800794,41.909635],[-80.900342,41.868912],[-81.0022694,41.8491725],[-81.05192,41.839557],[-81.184368,41.786671],[-81.286925,41.760243],[-81.388632,41.707144],[-81.466038,41.649148],[-81.4886827,41.6344639],[-81.633652,41.540458],[-81.738755,41.48855],[-81.7685751,41.4914896],[-81.810758,41.495648],[-81.8225036,41.4952594],[-81.937862,41.491443],[-81.960325,41.5005533],[-81.9684807,41.503861],[-81.994565,41.51444],[-82.0711505,41.496912],[-82.181598,41.471634],[-82.268479,41.430842],[-82.3480192,41.4272633],[-82.361784,41.426644],[-82.460599,41.386316],[-82.533208,41.391157],[-82.616952,41.428425],[-82.687921,41.492324],[-82.6905672,41.4967058],[-82.717878,41.54193],[-82.834101,41.587587],[-82.859531,41.576371],[-82.934369,41.514353],[-83.028072,41.555656],[-83.066593,41.59534],[-83.1638214,41.6241303],[-83.23166,41.644218],[-83.326825,41.701562],[-83.409531,41.691247],[-83.453832,41.732647],[-83.5855418,41.728772],[-83.763038,41.72355],[-83.7631499,41.7235468],[-83.8803905,41.7201945],[-84.134417,41.712931],[-84.360419,41.7069559],[-84.3995488,41.7059214],[-84.438067,41.704903],[-84.806082,41.696089],[-84.8049582,41.5301378],[-84.8042533,41.4260497],[-84.804133,41.408292],[-84.8037036,41.2712583],[-84.803645,41.2525617],[-84.803234,41.121414],[-84.8028596,40.9893741],[-84.8026702,40.9225687],[-84.802119,40.728163],[-84.802119,40.7281459],[-84.8024139,40.5722129],[-84.802547,40.50181],[-84.8029314,40.4653866],[-84.804119,40.352844],[-84.8041205,40.3527622],[-84.8049173,40.3100959],[-84.808706,40.107216],[-84.8101612,40.0050675],[-84.8114171,39.9169136],[-84.8141281,39.7266165],[-84.814129,39.726556],[-84.8157059,39.5677217],[-84.8161602,39.5219681],[-84.817453,39.391753],[-84.8188771,39.3051662],[-84.8188775,39.3051436],[-84.820159,39.227225]]]]},"properties":{"AFFGEOID":"0400000US39","ALAND":105823701267,"AWATER":10274036690,"GEOID":"39","LSAD":"00","NAME":"Ohio","STATEFP":"39","STATENS":"01085497","STUSPS":"OH"}}`)

	var f geojson.Feature
	_ = f.UnmarshalJSON(b)

	g, _ := geo.MakeGeometryFromGeomT(f.Geometry)

	// transform from epsg:4326 to epsg:2163 to buffer in units of meters
	// from: https://epsg.io/4326
	// to: https://epsg.io/2163

	gg, _ := geotransform.Transform(
		g,
		geoprojbase.MakeProj4Text("+proj=longlat +datum=WGS84 +no_defs"),
		geoprojbase.MakeProj4Text("+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs "),
		2163,
	)

	ggb, _ := geomfn.Buffer(gg, geomfn.MakeDefaultBufferParams(), 5000) // buffer 5000 meters

	gb, _ := geotransform.Transform(
		ggb,
		geoprojbase.MakeProj4Text("+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs "),
		geoprojbase.MakeProj4Text("+proj=longlat +datum=WGS84 +no_defs"),
		4326,
	)

	gt, _ := gb.AsGeomT()

	f = geojson.Feature{Geometry: gt}
	b, _ = f.MarshalJSON()

	fmt.Println(string(b))
}
